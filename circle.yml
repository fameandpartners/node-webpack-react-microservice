machine:
  node:
    version: 8.1.4

dependencies:
  branch: /release.*/
    override:
      - sh ./build-dev.sh
  branch: master
    override:
      - sh ./build-prod.sh
    # - npm install -g npm
    # - npm install:
    #     pwd:
    #       app
    # - set PUBLIC_URL=https://content-dev.fameandgroups.com/ && echo $PUBLIC_URL && npm run build:
    #     pwd:
    #       app
    # - echo 'yicky'

test:
  override:
    - echo 'yacky'

deployment:
  qa:
    branch: /release.*/
    commands:
      - zip -r node_deploy.zip . -x \*node_modules\*:
          pwd: 
            app
      - aws s3 cp node_deploy.zip s3://dev-fameandpartners-website/deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip:
          pwd: 
            app
      - aws elasticbeanstalk create-application-version --application-name pdpode --version-label $CIRCLE_BUILD_NUM --source-bundle S3Bucket=dev-fameandpartners-website,S3Key=deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip --region us-east-1
      - aws elasticbeanstalk update-environment --environment-name nodey-qa --version-label $CIRCLE_BUILD_NUM --region us-east-1
  production:
    branch: master
    commands:
      - zip -r node_deploy.zip . -x \*node_modules\*:
          pwd: 
            app
      - aws s3 cp node_deploy.zip s3://dev-fameandpartners-website/deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip:
          pwd: 
            app
      - aws elasticbeanstalk create-application-version --application-name pdpode --version-label $CIRCLE_BUILD_NUM --source-bundle S3Bucket=dev-fameandpartners-website,S3Key=deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip --region us-east-1
      - aws elasticbeanstalk update-environment --environment-name nodey-prod --version-label $CIRCLE_BUILD_NUM --region us-east-1