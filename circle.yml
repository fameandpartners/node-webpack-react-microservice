machine:
  node:
    version: 8.1.4

dependencies:
    override:
      - if [ $CIRCLE_BRANCH = 'master' ]; then echo "master"; elif [["$CIRCLE_BRANCH" =~ *release2* ]]; then echo 2; else echo 1; fi

test:
  override:
    - echo 'yacky'

deployment:
  qa:
    branch: /release1.*/
    commands:
      - zip -r node_deploy.zip . -x \*node_modules\*:
          pwd: 
            app
      - aws s3 cp node_deploy.zip s3://dev-fameandpartners-website/deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip:
          pwd: 
            app
      - aws elasticbeanstalk create-application-version --application-name pdpode --version-label $CIRCLE_BUILD_NUM --source-bundle S3Bucket=dev-fameandpartners-website,S3Key=deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip --region us-east-1
      - aws elasticbeanstalk update-environment --environment-name nodey-qa --version-label $CIRCLE_BUILD_NUM --region us-east-1
  qa2:
    branch: /release2.*/
    commands:
      - zip -r node_deploy.zip . -x \*node_modules\*:
          pwd: 
            app
      - aws s3 cp node_deploy.zip s3://dev-fameandpartners-website/deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip:
          pwd: 
            app
      - aws elasticbeanstalk create-application-version --application-name pdpode --version-label $CIRCLE_BUILD_NUM --source-bundle S3Bucket=dev-fameandpartners-website,S3Key=deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip --region us-east-1
      - aws elasticbeanstalk update-environment --environment-name nodey-qa2 --version-label $CIRCLE_BUILD_NUM --region us-east-1
  production:
    branch: master
    commands:
      - zip -r node_deploy.zip . -x \*node_modules\*:
          pwd: 
            app
      - aws s3 cp node_deploy.zip s3://dev-fameandpartners-website/deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip:
          pwd: 
            app
      - aws elasticbeanstalk create-application-version --application-name pdpode --version-label $CIRCLE_BUILD_NUM --source-bundle S3Bucket=dev-fameandpartners-website,S3Key=deploy/pdpode/node_deployebs.$CIRCLE_BUILD_NUM.zip --region us-east-1
      - aws elasticbeanstalk update-environment --environment-name nodey-prod --version-label $CIRCLE_BUILD_NUM --region us-east-1